YUI.add("gallery-ac-plugin-v2",function(D){function A(){A.superclass.constructor.apply(this,arguments);}var C="autocomplete",L=D.Lang,E=D.Array.each,F={query:function(Q){var M=this,P=M.get("dataSource"),O=Q.value,N=D.bind(H,M);if(P){P.sendRequest({request:M.get("queryTemplate")(O),callback:{success:N,failure:N}});}}};D.Plugin.ACPlugin2=D.extend(A,D.Plugin.Base,{initializer:function(){var M=this,N=M.get("host");J(M,N);var O=F;E(["query","load","show","hide","next","previous"],function(P){M.publish("ac:"+P,{broadcast:2,bubbles:1,context:M,preventable:true,defaultFn:O[P]||null,prefix:"ac"});},M);K(N);},destructor:function(){D.detach(D.stamp(this)+"|");},open:function(){this.fire("ac:show");},next:function(M){M.preventDefault();this.fire("ac:next");},previous:function(M){M.preventDefault();this.fire("ac:previous");},close:function(){this.fire("ac:hide");}},{NAME:"ACPlugin2",NS:"ac",ATTRS:{queryValue:{getter:function(){return this.get("host").get("value");},setter:function(M){this.get("host").set("value",M);return(this._cachedValue=M);}},dataSource:{validator:function(M){return M&&L.isFunction(M.sendRequest);}},minQueryLength:{value:3,validator:L.isNumber},queryTemplate:{value:encodeURIComponent,setter:function(M){return(L.isFunction(M)?M:function(N){return M.replace(/(^|[^\\])((\\{2})*)\{query\}/,"$1$2"+encodeURIComponent(N)).replace(/(^|[^\\])((\\{2})*)\\(\{query\})/,"$1$2$4");});}}}});function J(M,O){var N=D.stamp(this)+"|";D.on("valueChange",I,O,M);D.on("key",M.next,O,"down:40",M);D.on("key",M.previous,O,"down:38",M);D.on("key",M.close,O,"down:27",M);D.on("key",M.close,O,"down:9",M);D.on("key",function(P){P.preventDefault();if(P.currentTarget.get("id")===O.get("id")){M.close();return false;}},O,"down:13",M);D.on("click",function(Q){var P=Q.target;if(P.get("id")!=O.get("id")){M.close();}},document);}function I(N){var M=N.value;if(!M){return this.close();}if(M===this._cachedValue||M.length<this.get("minQueryLength")){return;}this._cachedValue=M;this.fire("ac:query",{value:N.value});}function B(M){return function(){if(M){M.setAttribute(C,"on");}M=null;};}function K(M){var O=D.Node.getDOMNode(M),P=O.getAttribute(C);if((P&&P!=="off")||P===null||P===undefined){var N=B(O);D.on("beforeunload",N,window);D.on("unload",N,window);}O.setAttribute(C,"off");}function H(N){var M=(N&&N.response&&N.response.results)?N.response.results:N;if(M&&!(M&&("length" in M)&&M.length===0)){this.fire("ac:load",{results:G(M,this.get("queryValue")),query:this.get("queryValue"),total:N.response.meta.total});}}function G(P,O){var Q=[];var N=new RegExp(O,"i");for(var M=0;M<P.length;M++){if(P[M].key.match(N)||P[M].label.match(N)){Q[Q.length]=P[M];}}return Q;}},"@VERSION@",{requires:["node-base","node-pluginhost","plugin","gallery-value-change","event-key"]});